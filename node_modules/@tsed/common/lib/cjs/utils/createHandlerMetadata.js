"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createHandlerMetadata = void 0;
const schema_1 = require("@tsed/schema");
const HandlerMetadata_1 = require("../domain/HandlerMetadata");
const HandlerType_1 = require("../interfaces/HandlerType");
function isMetadata(input) {
    return input instanceof HandlerMetadata_1.HandlerMetadata;
}
/**
 * @ignore
 */
function createHandlerMetadata(injector, obj, routeOptions = {}) {
    if (isMetadata(obj)) {
        return obj;
    }
    let options;
    if (obj instanceof schema_1.EndpointMetadata) {
        const provider = injector.getProvider(routeOptions.token);
        options = {
            token: provider.token,
            target: provider.useClass,
            scope: provider.scope,
            type: HandlerType_1.HandlerType.ENDPOINT,
            propertyKey: obj.propertyKey
        };
    }
    else {
        const provider = injector.getProvider(obj);
        if (provider) {
            options = {
                token: provider.token,
                target: provider.useClass,
                scope: provider.scope,
                type: HandlerType_1.HandlerType.MIDDLEWARE,
                propertyKey: "use"
            };
        }
        else {
            options = {
                target: obj
            };
        }
    }
    options.routeOptions = routeOptions;
    return new HandlerMetadata_1.HandlerMetadata(options);
}
exports.createHandlerMetadata = createHandlerMetadata;
//# sourceMappingURL=createHandlerMetadata.js.map