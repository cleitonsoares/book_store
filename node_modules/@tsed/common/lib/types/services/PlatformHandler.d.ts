import { InjectorService, Provider } from "@tsed/di";
import { ArgScope, HandlerWithScope, PlatformParams } from "@tsed/platform-params";
import { PlatformResponseFilter } from "@tsed/platform-response-filter";
import { EndpointMetadata } from "@tsed/schema";
import { HandlerMetadata } from "../domain/HandlerMetadata";
import { PlatformContext } from "../domain/PlatformContext";
import { PlatformRouteWithoutHandlers } from "../interfaces/PlatformRouteOptions";
export interface OnRequestOptions {
    $ctx: PlatformContext;
    metadata: HandlerMetadata;
    handler: HandlerWithScope;
    next?: any;
    err?: any;
    [key: string]: any;
}
/**
 * Platform Handler abstraction layer. Wrap original class method to a pure platform handler (Express, Koa, etc...).
 * @platform
 */
export declare class PlatformHandler {
    protected injector: InjectorService;
    protected params: PlatformParams;
    protected responseFilter: PlatformResponseFilter;
    constructor(injector: InjectorService, params: PlatformParams);
    /**
     * Create a native middleware based on the given metadata and return an instance of AnyToPromiseWithCtx
     * @param input
     * @param options
     */
    createHandler(input: EndpointMetadata | HandlerMetadata | any, options?: PlatformRouteWithoutHandlers): any;
    /**
     * Create injectable handler from the given provider
     * @param provider
     * @param propertyKey
     */
    createCustomHandler(provider: Provider, propertyKey: string): ($ctx: PlatformContext, next?: any) => Promise<any>;
    /**
     * Send the response to the consumer.
     * @param data
     * @param ctx
     * @protected
     */
    flush(data: any, ctx: PlatformContext): Promise<void>;
    compileHandler(metadata: HandlerMetadata): (scope: Record<string, any>) => Promise<any>;
    protected onCtxRequest(requestOptions: OnRequestOptions): Promise<any>;
    /**
     * Call handler when a request his handle
     * @param requestOptions
     */
    protected onRequest(requestOptions: OnRequestOptions): Promise<any>;
    protected onError(er: Error, requestOptions: OnRequestOptions): Promise<any>;
    /**
     * Manage success scenario
     * @param data
     * @param requestOptions
     * @protected
     */
    protected onSuccess(data: any, requestOptions: OnRequestOptions): Promise<any>;
    /**
     * Call the returned middleware by the handler.
     * @param middleware
     * @param ctx
     * @param next
     * @protected
     */
    protected callReturnedMiddleware(middleware: any, ctx: PlatformContext, next: any): any;
    /**
     * create Raw handler
     * @param metadata
     */
    protected createRawHandler(metadata: HandlerMetadata): any;
    /**
     * Set response headers
     * @param ctx
     * @protected
     */
    protected setHeaders(ctx: PlatformContext): void;
    protected next(requestOptions: OnRequestOptions): any;
    protected getDefaultArgs(metadata: HandlerMetadata): (scope: ArgScope<PlatformContext>) => Promise<any[]>;
}
