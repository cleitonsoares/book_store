import { createInstance } from "./createInstance.js";
import { isArrayOrArrayClass } from "./isArray.js";
import { isPrimitive } from "./isPrimitive.js";
import { objectKeys } from "./objectKeys.js";
function reducer() {
    return (collection, value) => {
        collection.indexOf(value) === -1 && collection.push(value);
        return collection;
    };
}
/**
 * Deep extends a model with another one.
 * @param out
 * @param obj
 * @param reducers
 * @returns {any}
 * @deprecated Since 2021-07-16. Use deepMerge instead of
 */
export function deepExtends(out, obj, reducers = {}) {
    if (obj === undefined || obj === null) {
        return out;
    }
    if (isPrimitive(obj) || typeof obj === "symbol" || typeof obj === "function") {
        return obj;
    }
    if (isArrayOrArrayClass(obj)) {
        out = out || [];
    }
    else {
        out = out || createInstance(obj);
    }
    const defaultReducer = reducers["default"] ? reducers["default"] : reducer();
    const set = (key, value) => {
        if (isArrayOrArrayClass(obj)) {
            out.indexOf(value) === -1 && out.push(value);
        }
        else {
            out[key] = value;
        }
    };
    objectKeys(obj).forEach((key) => {
        let value = obj[key];
        // istanbul ignore next
        if (value === undefined || value === null) {
            return;
        }
        // istanbul ignore next
        if (value === "" && out[key] !== "") {
            return;
        }
        if (isPrimitive(value) || typeof value === "function") {
            set(key, value);
            return;
        }
        if (isArrayOrArrayClass(value)) {
            value = value.map((value) => deepExtends(undefined, value));
            set(key, []
                .concat(out[key] || [], value)
                .reduce((collection, value) => (reducers[key] ? reducers[key](collection, value) : defaultReducer(collection, value)), []));
            return;
        }
        // Object
        if (isArrayOrArrayClass(obj)) {
            set(key, deepExtends(undefined, value, reducers));
        }
        else {
            set(key, deepExtends(out[key], value, reducers));
        }
    });
    if (isArrayOrArrayClass(out)) {
        out.reduce((collection, value) => defaultReducer(collection, value), []);
    }
    return out;
}
//# sourceMappingURL=deepExtends.js.map