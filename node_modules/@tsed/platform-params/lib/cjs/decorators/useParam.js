"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.UseParam = void 0;
const core_1 = require("@tsed/core");
const schema_1 = require("@tsed/schema");
const ParamTypes_1 = require("../domain/ParamTypes");
const paramFn_1 = require("./paramFn");
const useDeserialization_1 = require("./useDeserialization");
const useParamType_1 = require("./useParamType");
const useType_1 = require("./useType");
const useValidation_1 = require("./useValidation");
/**
 * @ignore
 * @param options
 */
function mapPipes(options) {
    const { paramType, useType, expression, useValidation, useConverter, ...props } = options;
    return [
        useType
            ? (0, useType_1.UseType)(useType)
            : (0, paramFn_1.ParamFn)((entity, parameters) => {
                if (entity.isCollection && entity.type === Object && paramType !== ParamTypes_1.ParamTypes.FILES) {
                    (0, schema_1.Any)()(...parameters);
                }
            }),
        useValidation && (0, useValidation_1.UseValidation)(),
        useConverter && (0, useDeserialization_1.UseDeserialization)(props)
    ];
}
function UseParam(...args) {
    const options = {
        ...(((0, core_1.isString)(args[0]) ? args[1] : args[0]) || {}),
        paramType: (0, core_1.isString)(args[0]) ? args[0] : args[0].paramType
    };
    return (0, core_1.useDecorators)((0, useParamType_1.UseParamType)(options), ...mapPipes(options));
}
exports.UseParam = UseParam;
//# sourceMappingURL=useParam.js.map