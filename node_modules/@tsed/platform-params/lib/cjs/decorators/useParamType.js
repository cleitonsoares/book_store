"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.UseParamType = void 0;
const core_1 = require("@tsed/core");
const schema_1 = require("@tsed/schema");
const paramFn_1 = require("./paramFn");
const useParamExpression_1 = require("./useParamExpression");
const ParamTypes_1 = require("../domain/ParamTypes");
/**
 * Get the object from request (like body, params, query, etc...).
 *
 * @decorator
 * @operation
 * @input
 * @pipe
 */
function UseParamType(options) {
    return (0, core_1.useDecorators)((0, paramFn_1.ParamFn)((param) => {
        var _a;
        if ((0, schema_1.isParameterType)(options.paramType)) {
            param.parameter.in(options.paramType);
        }
        param.paramType = options.paramType;
        if ((0, core_1.isBuffer)(param.type) || (0, core_1.isBuffer)(options.useType) || options.paramType === ParamTypes_1.ParamTypes.RAW_BODY) {
            param.paramType = ParamTypes_1.ParamTypes.RAW_BODY;
            (_a = param.parent.operation) === null || _a === void 0 ? void 0 : _a.consumes(["*/*"]);
        }
        param.dataPath = options.dataPath || ParamTypes_1.PARAM_TYPES_DATA_PATH[param.paramType] || "$ctx";
    }), options.expression && (0, useParamExpression_1.UseParamExpression)(options.expression), options.expression && (0, schema_1.Name)(options.expression));
}
exports.UseParamType = UseParamType;
//# sourceMappingURL=useParamType.js.map