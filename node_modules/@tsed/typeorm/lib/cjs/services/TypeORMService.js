"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.TypeORMService = void 0;
const tslib_1 = require("tslib");
const di_1 = require("@tsed/di");
const core_1 = require("@tsed/core");
const typeorm_1 = require("typeorm");
const createConnection_1 = require("../utils/createConnection");
let TypeORMService = class TypeORMService {
    constructor() {
        /**
         *
         * @type {"typeorm".ConnectionManager}
         * @private
         */
        this.connectionManager = (0, typeorm_1.getConnectionManager)();
    }
    /**
     *
     * @returns {Promise<"typeorm".Connection>}
     */
    async createConnection(connectionOptions) {
        const name = (0, core_1.getValue)(connectionOptions, "name", "default");
        try {
            const connection = await (0, createConnection_1.createConnection)({ ...connectionOptions, name });
            this.injector.logger.info(`Connected with typeorm to database: ${connection.name}`);
            return connection;
        }
        catch (err) {
            /* istanbul ignore next */
            console.error(err);
            /* istanbul ignore next */
            process.exit();
        }
    }
    /**
     *
     * @returns {"typeorm".Connection}
     */
    get(id = "default") {
        return this.connectionManager.get(id);
    }
    /**
     *
     * @param {string} id
     * @returns {boolean}
     */
    has(id = "default") {
        return this.connectionManager.has(id);
    }
    closeConnections() {
        const promises = this.connectionManager.connections.map((instance) => {
            if (instance.isConnected) {
                return instance.close();
            }
        });
        return Promise.all(promises);
    }
};
tslib_1.__decorate([
    (0, di_1.Inject)(di_1.InjectorService),
    tslib_1.__metadata("design:type", di_1.InjectorService)
], TypeORMService.prototype, "injector", void 0);
TypeORMService = tslib_1.__decorate([
    (0, di_1.Service)()
], TypeORMService);
exports.TypeORMService = TypeORMService;
//# sourceMappingURL=TypeORMService.js.map